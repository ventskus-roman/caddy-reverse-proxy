:{$PORT} {
  # CORS (если нужен для WebView/браузера)
  @options method OPTIONS
  handle @options {
    header Access-Control-Allow-Origin "*"
    header Access-Control-Allow-Headers "*"
    header Access-Control-Allow-Methods "GET,POST,PUT,PATCH,DELETE,OPTIONS"
    respond 204
  }

  # ----- Основной KIE API -----  https://api.kie.ai  (Bearer-токен обязателен)
  handle_path /kie/* {
    # ВСТАВЛЯЕМ АВТОРИЗАЦИЮ ДО ПРОКСИ
    request_header Authorization "Bearer {env.KIE_API_KEY}"

    reverse_proxy https://api.kie.ai {
      # Host на всякий случай фиксируем (обычно не обязателен)
      header_up Host api.kie.ai
    }
  }

  # ----- File Upload API -----   https://kieai.redpandaai.co  (тоже Bearer)
  handle_path /upload/* {
    request_header Authorization "Bearer {env.KIE_API_KEY}"

    reverse_proxy https://kieai.redpandaai.co {
      header_up Host kieai.redpandaai.co
    }
  }

  respond 404
}
